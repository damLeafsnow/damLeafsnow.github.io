## 计算机组成与体系结构（二）

### 流水线技术(★★★★)

#### 概念

- 相关参数计算:**流水线执行时间计算**、**流水线吞吐率**、流水线加速比、流水线效率

- 流水线是指在程序执行时**多条指令重叠进行操作**的一种准并行处理实现技术。针对不同指令各种部件同时处理，提高部件利用率和指令的平均执行速度。

  - 取指->分析->执行 

    不使用流水线

    | 取指 | 1    |      |      | 2    |      |      | 3    |      |      |
    | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
    | 分析 |      | 1    |      |      | 2    |      |      | 3    |      |
    | 执行 |      |      | 1    |      |      | 2    |      |      | 3    |

    流水线处理

    | 取指 |  1   |  2   |  3   |      |      |
    | :--: | :--: | :--: | :--: | :--: | :--: |
    | 分析 |      |  1   |  2   |  3   |      |
    | 执行 |      |      |  1   |  2   |  3   |

    利用空余时间片

#### 流水线计算

- 流水线周期为执行时间最长的一段
- 流水线计算公式:
  - 1条指令执行时间+(指令条数-1)*流水线周期
  - **理论公式：(t1+t2+..+tk)+(n-1)*Δt**（无答案时用实践公式）
  - 实践公式：$$k*Δt+(n-1)*Δt$$

#### 超标量流水线

度:同时操作的流水线数量

​	度为2,只需要1/2条指令的执行时间

| 取指 | 1    | 3    | 5    | .    | .    | .    | n-1  |      |      |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 取指 | 2    | 4    | 6    | .    | .    | .    | n    |      |      |
| 分析 |      | 1    | 3    | 5    | .    | .    | .    | n-1  |      |
| 分析 |      | 2    | 4    | 6    | .    | .    | .    | n    |      |
| 执行 |      |      | 1    | 3    | 5    | .    | .    | .    | n-1  |
| 执行 |      |      | 2    | 4    | 6    | .    | .    | .    | n    |

#### 流水线吞吐率计算

- 流水线的吞吐率**TP**(Though Put rate):在**单位时间内流水线所完成的任务数量或输出的结果数量**。

- 计算公式:

  $$TP={指令条数\over流水线执行时间}$$

- 流水线最大吞吐率:

  $${TP_{max}=\frac1{Δt}}$$



### 存储系统(★★★★)

#### 层次化存储结构

- CPU：寄存器，最快，容量小，成本高
- **Cache(*)**：按内容读取
- 内存：分两类，随机存储器(RAM)、只读存储器(ROM)
- 外存：硬盘、光盘、U盘等

#### Cache

###### 概念

- 在计算机存储体系中，Cache访问速度最快（仅次于CPU寄存器）

- 使用Cache改善系统性能的依据是程序的**局部性原理**。

- 如果以h代表对Cache的访问**命中率**，t<sub>1</sub>表示Cache的周期时间，t<sub>2</sub>表示主存储器周期时间，以读操作为例，使用"Cache+主存储器"的系统的平均周期为t<sub>3</sub>，则:**（未考过）**

  ​	$$t_3=h*t_1+(1-h)*t_2$$

  其中，(1-h)又称为失效率（未命中率）

######  映像

- 直接相联映像：硬件电路较简单，但**冲突率最高**。
- 全相联映像：电路难于设计实现，只适用于小容量Cache，**冲突率最低**。
- 组相联映象：折中。
- 地址映像是将主存与Cache的储存空间划分成若干大小相同的页（或称为块）。

###### 直接相联映像

![直接相联映像]({{ site.baseurl }}/images/直接相联映像.png)

- Cache第n位只存储主存每一区第n页的数据
- 冲突率最高，但访问速度最快

###### 全相联映像

![全相联映像]({{ site.baseurl }}/images/全相联映像.png)

- Cache任何一页可以存储主存任何一页
- 冲突率最低，但查询复杂

#####  组相联映象

![组相联映像]({{ site.baseurl }}/images/组相联映像.png)

- 先将数据分组，主存和Cache组直接相连，组内全相联
- 折中兼具两种优势，但消耗系统资源

##### 主存-编址与计算

###### 存储单元

- 按字编址：存储体的存储单元是字存储单元，即最小寻址为一个字。

- 按字节编址：村出题的存储单元是字节存储单元，即最小寻址单位是一个字节。

- 1 Byte = 8 bit

- 根据存储器所要求的容量和选定的存储芯片的容量，就可以计算出所需芯片的总数,即：

  总片数=总容量/每片容量



### 总线系统(★)

- 一条总线同一时刻仅允许**一个设备发送**，但允许**多个设备接收**。
- 分类:
  - 数据总线(Data Bus)：在CPU于RAM之间来回传送需要处理或是需要储存的数据。
  - 地址总线(Address Bus)：用来指定在RAM之中储存的数据的地址。
  - 控制总线(Control Bus)：讲微处理器控制单元的信号传送到周边设备，如USB Bus和1394Bus。



### 可靠性(★)

#### 串联系统与并联系统

##### 可靠性

- 串联系统可靠性：R=R<sub>1</sub>xR<sub>2</sub>x...xR<sub>n</sub>	(任一不可靠则不可靠)
- 并联系统可靠性：R=1-(1-R<sub>1</sub>)x(1-R<sub>1</sub>)x...x(1-R<sub>n</sub>)     (有一可靠即可靠)

#### N模混合系统（串并联混合）

##### 可靠性

![N模混合系统]({{ site.baseurl }}/images/N模混合系统.png)



### 校验码(★★★)

#### 基础知识

- 码距：任何一种编码都有许多码字构成，任意**两个码字之间最少变化的二进制位数**就称为数据校验码的码距。
- 例：用4位二进制数表示16种状态，则有16个不同的码字0000-1111，此时码距为1。

#### 奇偶校验

- 奇偶校验码的编码方法：由若干为有效信息（如一个字节），再加上一个二进制位（校验位）组成校验码。
  - 奇校验：整个校验码（有效信息位和校验位）中“1”的个数为奇数。
  - 偶校验：整个校验码（有效信息位和校验位）中“1”的个数为偶数。
  - 奇偶校验可检查**1位**的错误，**不可纠错**。

#### CRC循环冗余校验

- CRC编码方法：在k位信息码之后拼接r位校验码。
- 编码规律：
  - 将待编码有效信息表示为多项式M(X)
  - 左移M(X)k位，空出k位放置校验位
  - 选取一个K+1位多项式G(X)，做模2除
  - 将余数拼接到左移后的有效信息后拼接为CRC码（共N+k位）
- 校验：将接收到的CRC码用G（X）除，若正确则余数为0。若不正确，不同位数出错则余数不同，余数与出错位序号有唯一对应关系。
- CRC校验**可检错**，**不可纠错**。

#### 海明校验码

- 原理：在有效信息位中加入几个校验位形成海明码，使码距比较均匀地拉大，并把海明码的每个二进制位分配到几个奇偶校验组中。当某一位出错后，就会引起有关的几个校验位的值发生变化，这不但可以发现错误，还能指出错误的位置，为自动纠错提供了依据。
- **校验位个数计算公式**(m=总位数，求r)：$$2^r≥m+r+1$$
- 海明校验**可检错也可纠错**。

